<?xml version="1.0"?>
<!-- FRE Usage documentation: http://www.gfdl.noaa.gov/fms/fre -->
<!-- $Id: MOM6z_SIS_025.xml,v 1.1.2.12 2013/12/03 17:38:38 Niki.Zadeh Exp $ -->
<!DOCTYPE setup [
<!ENTITY ROOT_LOCATION "/lustre/ltfs/scratch">
<!ENTITY ARCH_LOCATION "/lustre/ltfs/stage">
]>

<!--
Quick start guide

module load fre/bronx-6
fremake -x MOM6z_SIS_025.xml -p ncrc2.intel -t prod MOM6_SIS_compile
frerun  -x MOM6z_SIS_025.xml -p ncrc2.intel -t prod -r basic MOM6z_SIS_025_base_line_TEST 

To validate against fre schema do:
xmllint 2-noent 2-noout 2-xinclude 2-schema /home/fms/local/opt/fre-commands/bronx-6/etc/schema/fre.xsd ./MOM6z_SIS_025.xml

-->

<experimentSuite rtsVersion="4" xmlns:xi="http://www.w3.org/2001/XInclude">
   <property name="RELEASE"      value="siena_201309"/> <!-- CVS tag for shared source code -->
   <property name="MOM6_GIT_TAG" value="dev/master/2013.12.03"/>  <!-- git tag for MOM6 source code -->
   <property name="FRE_STEM"     value="siena_201309_mom6_2013.12.03"/>
   <property name="FRE_VERSION"  value="fre/bronx-7"/>

   <!--Production run properties. Users can modify these according to their need and/or performance analysis-->
   <property name="PROD_SIMTIME"   value="4"/>
   <!-- Post-processing start date and chunk lengths -->
   <property name="PP_START_YEAR"  value="1900"/>
   <property name="CHUNK_LENGTH_A" value="4yr"/>
   <property name="ANALYSIS_SWITCH" value="on"/>
   <property name="ANALYSIS_START"  value="1900"/>
   <property name="ANALYSIS_END"    value="1903"/>

   <property name="PROD_RUNTIME"         value="16:00:00"/>
   <property name="PROD_SEGTIME"         value="03:15:00"/>
   <property name="MASK_TABLE"           value="mask_table.1054.90x45"/> <!--layouts must be 90,45-->
   <property name="PROD_NPES"            value="2996"/> <!-- 90*45 - 1054 -->
   <property name="OCN_PROD_IO_LAYOUT"   value="9,5"/>
   <property name="ICE_PROD_LAYOUT"      value="90,45"/>
   <property name="ICE_PROD_IO_LAYOUT"   value="9,5"/>
   <property name="LND_PROD_LAYOUT"      value="90,45"/>
   <property name="FV_PROD_LAYOUT"       value="90,45"/>
   


   <!--Users need not change the following properties -->
   <property name="reference_tag"  value="siena_201309_mom6_20131108"/> <!-- Reference release tag for existing files in the archives for answer comparison. Used in "REFERENCE" property. -->
   <property name="PROG_MAIN"   value="coupler/coupler_main.o"/>
   <property name="MOM6_SRC"    value="$root/MOM6_SIS_compile/src/mom6"/> 

   <!-- The following properties are for testing/debugging purposes and should normally be empty-->
   <property name="MODIFIER"     value=""/>  
   <property name="DEBUGLEVEL"   value=""/>

   <setup xmlns:xi="http://www.w3.org/2001/XInclude">
    <!-- MDBI -->
    <fmsRelease>fmsversion</fmsRelease>
    <!-- /MDBI -->

<!-- ncrc platforms -->
	
    <platform name="ncrc2.intel">
      <project>gfdl_o</project>
      <directory stem="$(FRE_STEM)"/>
         <directory>
	   <root>&ROOT_LOCATION;/$USER/$(FRE_STEM)</root>
            <archive>&ARCH_LOCATION;/$USER/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)</archive>
            <stdout>&ARCH_LOCATION;/$USER/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/stdout</stdout>
            <scripts>$HOME/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/scripts</scripts>
            <state>$HOME/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/state</state>
            <work>/lustre/fs/scratch/$USER/work/$(FRE_STEM)/$FRE_JOBID</work>
         </directory>
      <csh><![CDATA[
          source $MODULESHOME/init/csh
          module use -a /ncrc/home2/fms/local/modulefiles
          module unload PrgEnv-pgi PrgEnv-pathscale PrgEnv-intel PrgEnv-gnu PrgEnv-cray
          module unload netcdf fre fre-commands
          module load PrgEnv-intel
          module swap intel intel/12.0.5.220

          module load $(FRE_VERSION)
#        setenv F_UFMTENDIAN big #This is needed only for models which have big endian native restarts
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        alias cpget 'cp \!^ \!^.copy ; \rm -f \!^ ; mv \!^.copy \!^ ; chmod +w \!^ '
     ]]></csh>

     <property name="NCRC_PLATFORM" value="$(platform)"/>
     <property name="GFDL_PLATFORM" value="gfdl"/>
     <property name="SGI_FLAGS" value=""/>
     <property name="FMS_ARCHIVE_ROOT" value="/lustre/fs/archive/fms"/>
     <property name="F2003_FLAGS" value="-DINTERNAL_FILE_NML -g -traceback"/> <!-- -g -traceback -->
     <property name="TAREXT"           value="tar"/>
     <property name="REFERENCE"        value="/lustre/ltfs/scratch/Niki.Zadeh/$(reference_tag)/$(name)/$(platform)-$(target)"/>
 
    </platform>

    <platform name="ncrc2.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='ncrc2.intel']/node())" />
    </platform>

<!-- gfdl platforms -->

    <platform name="gfdl.ncrc2-intel">
     <property name="NB_ROOT"  value="/nbhome/$USER/$(FRE_STEM)$(DEBUGLEVEL)/$(name)"/>
     <directory stem="$(FRE_STEM)">
     <!-- MDBI requires these to be listed in order to show the path under "Platform Environment" -->
        <archive>$ARCHIVE/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)</archive>
        <analysis>$(NB_ROOT)</analysis>
     <!-- /MDBI -->
     </directory>
     <property name="F2003_FLAGS"   value=""/>
     <property name="TAREXT"        value="tar"/>
     <property name="GFDL_PLATFORM" value="gfdl"/>
     <property name="NCRC_PLATFORM" value="ncrc2"/>
        <csh><![CDATA[
           source $MODULESHOME/init/csh
           module use -a /home/John.Krasting/local/modulefiles
           module purge
           module load jpk-analysis/0.0.4
           module load $(FRE_VERSION)
           #Some tricks to use the refineDiag and analysis scripts from a checkout of MOM6 at gfdl 
           setenv FREVERSION $(FRE_VERSION)           
           setenv NBROOT $(NB_ROOT)
           mkdir -p $NBROOT
           cd $NBROOT
           git clone /home/fms/git/ocean/mom6
         ]]></csh>

     <!--The following are not used, but needed by fre -->
     <property name="SGI_FLAGS" value=""/>
     <property name="REFERENCE" value=""/>
    </platform>

    <platform name="gfdl.ncrc2-default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.ncrc2-intel']/node())" />
    </platform>
    <platform name="gfdl.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.ncrc2-intel']/node())" />
    </platform>

</setup>



   <experiment name="MOM6_SIS_compile">
      <description>
Make the executable for ocean-ice experiments.
      </description>
      <component name="fms" paths="shared" includeDir="$root/MOM6_SIS_compile/src/shared/include">
<!-- MDBI, all contents in "" can be left empty --> 
<description 
domainName="infrastructure" 
communityName="FMS" 
communityVersion="$(RELEASE)" 
communityGrid=""/>
<!-- /MDBI -->
         <source>
            <codeBase version="$(RELEASE)"> shared </codeBase>
            <csh> <![CDATA[
	       #fix the hang issue with masktable
               cvs up -r tikal_fix_z1l shared/exchange/xgrid.F90 #in tikal testing tag
               #oda_core_ecda.F90 does not compile with GNU
               \rm -rf shared/oda_tools
            ]]> </csh> 
         </source>
         <compile>
            <cppDefs>-Duse_libMPI -Duse_netCDF $(F2003_FLAGS)</cppDefs>
         </compile>
      </component>

      <component name="mom6" requires="fms" paths="mom6/config_src/dynamic mom6/config_src/coupled_driver mom6/src/*/ mom6/src/*/*/">
<!-- MDBI -->
<description 
domainName="Ocean" 
communityName="GFDL-MOM6" 
communityVersion="$(MOM6_GIT_TAG)" 
communityGrid="Tripolar"/>
<!-- /MDBI -->
      
         <source versionControl="git" root="cvs.princeton.rdhpcs.noaa.gov:/home/fms/git/ocean">
            <codeBase version="$(MOM6_GIT_TAG)"> mom6 </codeBase>
            <csh> <![CDATA[
                #
            ]]> </csh> 
         </source>
         <compile>
            <cppDefs>$(F2003_FLAGS) </cppDefs>
            <makeOverrides>OPENMP=""</makeOverrides> <!-- openmp switch causes crash -->
         </compile>
      </component>

      <component name="ice_sis" paths="ice_param ice_sis" requires="fms">
<!-- MDBI -->
<description
domainName="Sea Ice"
communityName="GFDL-SIS"
communityVersion="$(MOM6_GIT_TAG)"
communityGrid="Tripolar"/>
<!-- /MDBI -->
      
         <source>
            <codeBase version="$(RELEASE)"> ice_param ice_sis </codeBase>
         </source>
         <compile>
            <cppDefs>$(F2003_FLAGS)</cppDefs>
         </compile>
      </component>
      <component name="land_null" paths="land_null" requires="fms">
<!-- MDBI -->
<description 
domainName="" 
communityName="" 
communityVersion="" 
communityGrid=""/>
<!-- /MDBI -->
         <source>
            <codeBase version="$(RELEASE)"> land_null </codeBase>
         </source>
      </component>
      <component name="atmos_null" paths="atmos_null atmos_param" requires="fms">
<!-- MDBI -->
<description 
domainName="" 
communityName="" 
communityVersion="" 
communityGrid=""/>
<!-- /MDBI -->

         <source>
            <codeBase version="$(RELEASE)"> atmos_null atmos_param/{monin_obukhov,diag_integral} </codeBase>
         </source>
      </component>
      <component name="coupler" paths="coupler" requires="fms land_null atmos_null ice_sis mom6">
<!-- MDBI -->
<description 
domainName="Coupler" 
communityName="GFDL-coupler" 
communityVersion="$(RELEASE)" 
communityGrid=""/>
<!-- /MDBI -->
         <source>
            <codeBase version="$(RELEASE)"> coupler </codeBase>
         </source>
         <compile>
            <cppDefs>$(F2003_FLAGS)</cppDefs>
         </compile>
      </component>
   </experiment>
 

<experiment name="MOM6z_SIS_025_base_line" inherit="MOM6_SIS_compile">
<!--The following description tags are needed to put the experiment in the MDBI-->
<description communityProject="OWG" communityModel="MOM6z_SIS_025 dev/master/2013.12.03" communityModelID="OWG_MOM6z_SIS_025" communityExperimentName="$(name)" communityExperimentID="$(name)" >
 global 1/4 degree z test case
</description>  
<!-- MDBI --> 
    <realization r="1" i="1" p="1"/>
    <scenario 
      communityForcing="CORE"
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      startTime="1900"
      endTime="1900" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

     <input>
     <dataFile label="namelist" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/input.nml</dataSource>
     </dataFile>
     <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/field_table</dataSource>
     </dataFile>
     <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/grid_spec.nc</dataSource>
        <dataSource site="gfdl">/archive/gold/datasets/MOM6z_SIS_025/siena/mosaic.unpacked/grid_spec.nc</dataSource> 
     </dataFile>
     <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/data_table</dataSource>
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/MOM_input</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/MOM_override</dataSource>
     </dataFile>

      <!--gridSpec mosaic datasets-->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/atmos_mosaic_tile1Xland_mosaic_tile1.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/atmos_mosaic_tile1Xocean_mosaic_tile1.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/land_mask.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/land_mosaic_tile1Xocean_mosaic_tile1.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/layer_coord.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ocean_hgrid.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ocean_mask.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ocean_mosaic.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ocean_topog.nc</dataSource>
       <!--hsmget cannot get this  <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/topog.nc</dataSource> -->
      </dataFile>

      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <!--Missing <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/OM3_zgrid.nc</dataSource> -->
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/seawifs_1998-2006_smoothed_2x_v2.nc</dataSource>
        <!--Missing  <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/sgs_h2.nc</dataSource> -->
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/tidal_amplitude.nc</dataSource>
	 <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/vgrid_cm4.nc</dataSource>
	 <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/WOA05_pottemp_salt.nc </dataSource>
      </dataFile>

      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ncar_precip.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ncar_rad.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/q_10_mod.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/runoff.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/salt_restore_v3.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/slp.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/sst_ice_clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/t_10_mod.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/u_10_mod.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/v_10_mod.clim.nc</dataSource>
      </dataFile>

      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/MOM_IC.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/MOM_IC_4.nc</dataSource>
      </dataFile>

      <!--Get the masktables too, since they may be needed in the children tests-->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.34.16x18</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.99.32x18</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.246.32x36</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.548.32x72</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.808.45x72</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.1029.45x90</dataSource> 
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.1404.45x120</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.1054.90x45</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.703.180x18</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/mask_table.873.120x30</dataSource>

      </dataFile>

      <diagTable>
$name
$baseDate
## output files
"ice_month",              1,  "months", 1, "days", "time",
"ice_daily",              1,  "days", 1, "days", "time",
"ocean_daily",            1,  "days", 1, "days", "time",
"ocean_month",            1,  "months", 1, "days", "time"
"ocean_annual",           12,  "months", 1, "days", "time"
"ocean_static",           -1,  "months", 1, "days", "time"


#==================
# OCEAN DIAGNOSTICS
#==================

"ocean_model","SSH","ssh","ocean_daily","all",.true.,"none",2
"ocean_model","SSU","ssu","ocean_daily","all",.true.,"none",2
"ocean_model","SSV","ssv","ocean_daily","all",.true.,"none",2
"ocean_model","SST","sst","ocean_daily","all",.true.,"none",2
"ocean_model","SSS","sss","ocean_daily","all",.true.,"none",2
"ocean_model","SST","sst_max","ocean_daily","all","max","none",2
"ocean_model","SST","sst_min","ocean_daily","all","min","none",2
"ocean_model","KPP_OBLdepth","KPP_OBLdepth_max","ocean_daily","all","max","none",2
"ocean_model","KPP_OBLdepth","KPP_OBLdepth_min","ocean_daily","all","min","none",2

"ocean_model","SSH","ssh","ocean_month","all",.true.,"none",2
#"ocean_model","SSU","ssu","ocean_month","all",.true.,"none",2
#"ocean_model","SSV","ssv","ocean_month","all",.true.,"none",2
#"ocean_model","SST","sst","ocean_month","all",.true.,"none",2
#"ocean_model","SSS","sss","ocean_month","all",.true.,"none",2
"ocean_model","SST","sst_max","ocean_month","all","max","none",2
"ocean_model","SST","sst_min","ocean_month","all","min","none",2
"ocean_model","KPP_OBLdepth","KPP_OBLdepth_max","ocean_month","all","max","none",2
"ocean_model","KPP_OBLdepth","KPP_OBLdepth_min","ocean_month","all","min","none",2
"ocean_model","temp","temp","ocean_month","all",.true.,"none",2
"ocean_model","salt","salt","ocean_month","all",.true.,"none",2
"ocean_model","u","u","ocean_month","all",.true.,"none",2
"ocean_model","v","v","ocean_month","all",.true.,"none",2
"ocean_model","Kd_interface","Kd_interface","ocean_month","all",.true.,"none",2
"ocean_model","Kd_shear","Kd_shear","ocean_month","all",.true.,"none",2
"ocean_model","Kd_itides","Kd_itides","ocean_month","all",.true.,"none",2
"ocean_model","KPP_Kheat","KPP_Kheat","ocean_month","all",.true.,"none",2
"ocean_model","taux",     "taux",     "ocean_month","all",.true.,"none",2
"ocean_model","tauy",     "tauy",     "ocean_month","all",.true.,"none",2
"ocean_model","ustar",    "ustar",    "ocean_month","all",.true.,"none",2
"ocean_model","PmE",      "PmE",      "ocean_month","all",.true.,"none",2
"ocean_model","SW",       "SW",       "ocean_month","all",.true.,"none",2
"ocean_model","Net_Heat",       "Net_Heat",       "ocean_month","all",.true.,"none",2
"ocean_model","LwLatSens","LwLatSens","ocean_month","all",.true.,"none",2
#"ocean_model","p_surf",   "p_surf",   "ocean_month","all",.false.,"none",2
"ocean_model","salt_flux","salt_flux","ocean_month","all",.true.,"none",2



"ocean_model","e","e","ocean_annual","all",.true.,"none",2
"ocean_model","temp","temp","ocean_annual","all",.true.,"none",2
"ocean_model","salt","salt","ocean_annual","all",.true.,"none",2
"ocean_model","u","u","ocean_annual","all",.true.,"none",2
"ocean_model","v","v","ocean_annual","all",.true.,"none",2
"ocean_model","Kd_interface","Kd_interface","ocean_annual","all",.true.,"none",2
"ocean_model","Kd_shear","Kd_shear","ocean_annual","all",.true.,"none",2
"ocean_model","Kd_itides","Kd_itides","ocean_annual","all",.true.,"none",2
"ocean_model","KPP_Kheat","KPP_Kheat","ocean_annual","all",.true.,"none",2
"ocean_model","uh","uh","ocean_annual","all",.true.,"none",2
"ocean_model","vh","vh","ocean_annual","all",.true.,"none",2
"ocean_model","T_ady",  "T_ady",  "ocean_annual","all",.true.,"none",2
"ocean_model","S_ady",  "S_ady",  "ocean_annual","all",.true.,"none",2

"ocean_model", "geolon",      "geolon",      "ocean_static", "all", .false., "none", 2
"ocean_model", "geolat",      "geolat",      "ocean_static", "all", .false., "none", 2
"ocean_model", "geolon_c",    "geolon_c",    "ocean_static", "all", .false., "none", 2
"ocean_model", "geolat_c",    "geolat_c",    "ocean_static", "all", .false., "none", 2
"ocean_model", "geolon_u",    "geolon_u",    "ocean_static", "all", .false., "none", 2
"ocean_model", "geolat_u",    "geolat_u",    "ocean_static", "all", .false., "none", 2
"ocean_model", "geolon_v",    "geolon_v",    "ocean_static", "all", .false., "none", 2
"ocean_model", "geolat_v",    "geolat_v",    "ocean_static", "all", .false., "none", 2
"ocean_model", "area_t",      "area_t",      "ocean_static", "all", .false., "none", 2
"ocean_model", "depth_ocean", "depth_ocean", "ocean_static", "all", .false., "none", 2
"ocean_model", "wet",         "wet",         "ocean_static", "all", .false., "none", 2
"ocean_model", "wet_c",       "wet_c",       "ocean_static", "all", .false., "none", 2
"ocean_model", "wet_u",       "wet_u",       "ocean_static", "all", .false., "none", 2
"ocean_model", "wet_v",       "wet_v",       "ocean_static", "all", .false., "none", 2

#================
# ICE DIAGNOSTICS
#================

 "ice_model", "CELL_AREA",  "CELL_AREA",  "ice_month", "all", .false., "none", 2
#"ice_model", "COSROT",     "COSROT",     "ice_month", "all", .false., "none", 2
 "ice_model", "GEOLAT",     "GEOLAT",     "ice_month", "all", .false., "none", 2
 "ice_model", "GEOLON",     "GEOLON",     "ice_month", "all", .false., "none", 2
#"ice_model", "SINROT",     "SINROT",     "ice_month", "all", .false., "none", 2
#
# "ice_model", "AGE",        "AGE",        "ice_month", "all", .true., "none", 2
# "ice_model", "ALB",        "ALB",        "ice_month", "all", .true., "none", 2
# "ice_model", "BHEAT",      "BHEAT",      "ice_month", "all", .true., "none", 2
# "ice_model", "BMELT",      "BMELT",      "ice_month", "all", .true., "none", 2
# "ice_model", "BSNK",       "BSNK",       "ice_month", "all", .true., "none", 2
# "ice_model", "CALVING",    "CALVING",    "ice_month", "all", .true., "none", 2
# "ice_model", "CALVING_HFLX",    "CALVING_HFLX",    "ice_month", "all", .true., "none", 2
 "ice_model", "CN",         "CN",         "ice_month", "all", .false., "none", 2
# "ice_model", "E2MELT",     "E2MELT",     "ice_month", "all", .true., "none", 2
# "ice_model", "EVAP",       "EVAP",       "ice_month", "all", .true., "none", 2
# "ice_model", "EXT",        "EXT",        "ice_month", "all", .true., "none", 2
# "ice_model", "FA_X",       "FA_X",       "ice_month", "all", .true., "none", 2
# "ice_model", "FA_Y",       "FA_Y",       "ice_month", "all", .true., "none", 2
# "ice_model", "FC_X",       "FC_X",       "ice_month", "all", .true., "none", 2
# "ice_model", "FC_Y",       "FC_Y",       "ice_month", "all", .true., "none", 2
# "ice_model", "FI_X",       "FI_X",       "ice_month", "all", .true., "none", 2
# "ice_model", "FI_Y",       "FI_Y",       "ice_month", "all", .true., "none", 2
# "ice_model", "FW_X",       "FW_X",       "ice_month", "all", .true., "none", 2
# "ice_model", "FW_Y",       "FW_Y",       "ice_month", "all", .true., "none", 2
# "ice_model", "FRAZIL",     "FRAZIL",     "ice_month", "all", .true., "none", 2
# "ice_model", "HI",         "HI",         "ice_daily", "all", .false., "none", 2
# "ice_model", "HI_PART",    "HI_PART",    "ice_month", "all", .true., "none", 2
# "ice_model", "HS",         "HS",         "ice_month", "all", .true., "none", 2
# "ice_model", "IX_TRANS",   "IX_TRANS",   "ice_month", "all", .true., "none", 2
# "ice_model", "IY_TRANS",   "IY_TRANS",   "ice_month", "all", .true., "none", 2
# "ice_model", "LH",         "LH",         "ice_month", "all", .true., "none", 2
# "ice_model", "LSNK",       "LSNK",       "ice_month", "all", .true., "none", 2
# "ice_model", "LSRC",       "LSRC",       "ice_month", "all", .true., "none", 2
# "ice_model", "LW",         "LW",         "ice_month", "all", .true., "none", 2
# "ice_model", "LWDN",       "LWDN",       "ice_month", "all", .true., "none", 2
"ice_model", "MI",         "MI",         "ice_daily", "all", .false., "none", 2
# "ice_model", "RAIN",       "RAIN",       "ice_month", "all", .true., "none", 2
# "ice_model", "RDG_RATE",   "RDG_RATE",   "ice_month", "all", .true., "none", 2
# "ice_model", "RDG_FRAC",   "RDG_FRAC",   "ice_month", "all", .true., "none", 2
# "ice_model", "RUNOFF",     "RUNOFF",     "ice_month", "all", .true., "none", 2
# "ice_model", "RUNOFF_HFLX",     "RUNOFF_HFLX",     "ice_month", "all", .true., "none", 2
# "ice_model", "SALTF",      "SALTF",      "ice_month", "all", .true., "none", 2
# "ice_model", "SH",         "SH",         "ice_month", "all", .true., "none", 2
# "ice_model", "SIGI",       "SIGI",       "ice_month", "all", .true., "none", 2
# "ice_model", "SIGII",      "SIGII",      "ice_month", "all", .true., "none", 2
# "ice_model", "SLP",        "SLP",        "ice_month", "all", .true., "none", 2
# "ice_model", "SNOWFL",     "SNOWFL",     "ice_month", "all", .true., "none", 2
# "ice_model", "SN2IC",      "SN2IC",      "ice_month", "all", .true., "none", 2
# "ice_model", "SSH",        "SSH",        "ice_month", "all", .true., "none", 2
# "ice_model", "SSS",        "SSS",        "ice_month", "all", .true., "none", 2
# "ice_model", "SST",        "SST",        "ice_month", "all", .true., "none", 2
#"ice_model", "SSH",        "SSH",        "ice_daily", "all", .false., "none", 2
# "ice_model", "SSS",        "SSS",        "ice_daily", "all", .false., "none", 2
# "ice_model", "SST",        "SST",        "ice_daily", "all", .false., "none", 2
# "ice_model", "UO",        "UO",        "ice_daily", "all", .false., "none", 2
# "ice_model", "VO",        "VO",        "ice_daily", "all", .false., "none", 2
# "ice_model", "STRENGTH",   "STRENGTH",   "ice_month", "all", .true., "none", 2
# "ice_model", "STRAIN_ANGLE","STRAIN_ANGLE","ice_month","all",.true., "none", 2
# "ice_model", "SW",         "SW",         "ice_month", "all", .true., "none", 2
# "ice_model", "SWDN",       "SWDN",       "ice_month", "all", .true., "none", 2
# "ice_model", "SW_NIR_DIF", "SW_NIR_DIF", "ice_month", "all", .true., "none", 2
# "ice_model", "SW_NIR_DIR", "SW_NIR_DIR", "ice_month", "all", .true., "none", 2
# "ice_model", "SW_VIS",     "SW_VIS",     "ice_month", "all", .true., "none", 2
# "ice_model", "SW_VIS_DIF", "SW_VIS_DIF", "ice_month", "all", .true., "none", 2
# "ice_model", "SW_VIS_DIR", "SW_VIS_DIR", "ice_month", "all", .true., "none", 2
# "ice_model", "TMELT",      "TMELT",      "ice_month", "all", .true., "none", 2
# "ice_model", "T1",         "T1",         "ice_month", "all", .true., "none", 2
# "ice_model", "T2",         "T2",         "ice_month", "all", .true., "none", 2
# "ice_model", "TS",         "TS",         "ice_month", "all", .true., "none", 2
# "ice_model", "UI",         "UI",         "ice_month", "all", .true., "none", 2
# "ice_model", "VI",         "VI",         "ice_month", "all", .true., "none", 2
# "ice_model", "UO",         "UO",         "ice_month", "all", .true., "none", 2
# "ice_model", "VO",         "VO",         "ice_month", "all", .true., "none", 2
# "ice_model", "XPRT",       "XPRT",       "ice_month", "all", .true., "none", 2
#
      </diagTable>

      <namelist name="coupler_nml">
       months = $months,
       days   = $days,
       current_date = 1900,1,1,0,0,0,
       hours = 0
       minutes = 0
       seconds = 0
       calendar = 'NOLEAP',
       dt_cpld  = 7200,
       dt_atmos = 7200,
       do_atmos = .false.,
       do_land = .false.,
       do_ice = .true.,
       do_ocean = .true.,
       atmos_npes = 0,
       ocean_npes = 0,
       concurrent = .false.
       use_lag_fluxes=.true. 
     </namelist>

     <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_override'  
     </namelist>

     <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 8000000
            stack_size =0
      </namelist>
     <namelist name="fms_io_nml" >
         fms_netcdf_restart=.true.
         threading_read='multi'
         threading_write='single'
         fileset_write='single'
         max_files_r = 200
         max_files_w = 200
         checksum_required = .false. ! This is needed to be able to restart the Ice under GNU. ref. Redmine issue 2000
     </namelist>
     <!-- The following namelist modifications are necessary for production runs since overrideParams won't work for production
       overrideParams="
         atmos_model_nml:layout=90,45;atmos_model_nml:mask_table='INPUT/mask_table.1054.90x45';
         land_model_nml:layout=90,45;land_model_nml:mask_table='INPUT/mask_table.1054.90x45';
         ice_model_nml:layout=90,45;ice_model_nml:io_layout=3,3;ice_model_nml:mask_table='INPUT/mask_table.1054.90x45'
                      "
      -->
     <namelist name="atmos_model_nml" >
       layout=$(FV_PROD_LAYOUT)
       mask_table='INPUT/$(MASK_TABLE)'
     </namelist>
     <namelist name="land_model_nml" >
       layout=$(LND_PROD_LAYOUT)
       mask_table='INPUT/$(MASK_TABLE)'
     </namelist>
     <namelist name="ice_model_nml" >
       layout=$(ICE_PROD_LAYOUT)
       io_layout=$(ICE_PROD_IO_LAYOUT)
       mask_table='INPUT/$(MASK_TABLE)'
           nsteps_dyn=144
           nsteps_adv=2
           num_part = 6
           wd_turn = 0.0
           spec_ice=.false.
           ice_bulk_salin = 0.005
           alb_sno = 0.85                    ! keep CM2 setting
           alb_ice = 0.65                    ! keep CM2 setting
           t_range_melt = 1.0                ! NOTE: CM2 uses 1.0
           heat_rough_ice = 5.0e-4
           cm2_bugs = .false.
           do_icebergs = .false.
           atmos_winds=.true.
           add_diurnal_sw = .true.
           do_ice_limit=.false.
           max_ice_limit=4.0
           channel_viscosity=5.e5
           chan_cfl_limit=0.001
           h_lo_lim = 1.e-10
    </namelist>

<!--Niki: find a way to specify the NIPROC,NJPROC below by $(NIPROC),... -->  
        <csh><![CDATA[
cd $work/INPUT
ln -s ocean_topog.nc topog.nc   #hsmget has problem with topog.nc
cpget MOM_override 
cat > MOM_override << OVERRIDE_EOF
#override undef NIPROC_IO
#override undef NJPROC_IO
#override IO_LAYOUT = $(OCN_PROD_IO_LAYOUT)
#override NIPROC = 90
#override NJPROC = 45
#override MASKTABLE = $(MASK_TABLE)
OVERRIDE_EOF
cd $work
     ]]></csh>
  
     <csh type="always">
        <![CDATA[
#------------------------------------------
## Find out whether to restart.

if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif
cd $work
## Run the model
#------------------------------------------
       ]]>
      </csh>    

   </input>
   <runtime>   
       <regression name="basic">
         <run days="10"   npes="$(PROD_NPES)"  runTimePerJob="00:30:00"/>
       </regression>
       <regression name="rts">
         <run days="5 5"   npes="$(PROD_NPES)"  runTimePerJob="00:30:00"/>
       </regression>

      <production simTime="$(PROD_SIMTIME)" units="years" npes="$(PROD_NPES)" runTime="$(PROD_RUNTIME)">
           <segment simTime="12" units="months" runTime="$(PROD_SEGTIME)"/>
       </production>



   </runtime>

      <postProcess> 
         <csh><![CDATA[
         cd $work/RESTART
         ncrcat icebergs.res.nc.* icebergs.res.nc
         rm -f icebergs.res.nc.*
         cd $work
         ncrcat iceberg_trajectories.nc.* iceberg_trajectories.nc
         rm -f iceberg_trajectories.nc.* 
         #Save the last line of timestats without the first (step number) column as a signature of MOM6 answers
         tail -1 timestats | cut -c8- > RESTART/$enddate.timestats.res
         #Save the whole timestats under ascii/
         mv timestats $enddate.timestats
         mv timestats.nc $enddate.timestats.nc

         #Make a directory to trick FRE to pick up and archive in ascii
         mkdir extra.results

         mv *velocity_truncations CPU_stats MOM_parameter_doc* extra.results/

         ]]></csh>

      <!--REFINE DIAG SCRIPT to untar the files under history/ -->
      <refineDiag script="$(NB_ROOT)/mom6/tools/analysis/MOM6_refineDiag.csh"/>

      <!--PostProcessing component models-->
      <component type="ocean"   start="$(PP_START_YEAR)">
        <timeSeries freq="monthly"  chunkLength="$(CHUNK_LENGTH_A)" source="ocean_month"/>

        <timeSeries freq="annual"  chunkLength="$(CHUNK_LENGTH_A)" source="ocean_annual">
          <analysis switch="on" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/> 
          <variables>temp salt</variables>
          <analysis switch="$(ANALYSIS_SWITCH)" startYear="$(ANALYSIS_START)" endYear="$(ANALYSIS_END)" cumulative="yes" script="$(NB_ROOT)/mom6/tools/analysis/MOM6_ts_annual.csh"/>
        </timeSeries>
      </component>

      <component type="ice"  start="$(PP_START_YEAR)"  source="ice_month">
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="annual"  interval="$(CHUNK_LENGTH_A)"/>
      </component>
-->

     </postProcess>

</experiment>

<experiment name="MOM6z_SIS_025_base_line_TEST" inherit="MOM6z_SIS_025_base_line">
<!--The following description tags are needed to put the experiment in the MDBI-->
<description communityProject="TEST" communityModel="MOM6z_SIS_025 dev/master/2013.12.03" communityModelID="OWG_MOM6z_SIS_025" communityExperimentName="$(name)" communityExperimentID="$(name)" >
 global 1/4 degree z test case
</description>
</experiment>

</experimentSuite>

